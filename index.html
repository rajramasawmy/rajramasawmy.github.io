<html>
<body>
<head>
  <title>ARGHHHH</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
  <!--<script src="file:///C:/Users/ramasawmyr/Documents/2016/FAC/Website/Package/shapefiles/zips shp USA/rr_test_data.js"></script>-->
  <script src="fellowData.js"></script>
	<script src="metro_red2.js"></script>
  <style>
    #map {
      width: 800px;
      height: 600px;
    }
    .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
  </style>
</head>
<h1>NIH Fellow Distribution by zip</h1>

<div id='map'></div>
<script>
var FD;

function highlightFeature(e){
  var layer = e.target;
  layer.setStyle(
    {
      weight : 5,
      color : 'black',
      fillColor : 'white',
      fillOpacity : 0.2
    }
  );
  if(!L.Browser.ie && !L.Browser.opera){
    layer.bringToFront();
  }
  info.update(layer.feature.properties);
}

function resetHighlight(e){
  FD.resetStyle(e.target);
  info.update();
}

function zoomToFeature(e){
  map.fitBounds(e.target.getBounds());
}

function onEachFeature_RR(feature,layer){
  layer.on(
    {
      mouseover : highlightFeature,
      mouseout : resetHighlight,
      click : zoomToFeature
    }
  );
}

function getCommuteColor(comEst){
var a = Math.floor(255 - 255*comEst/250);
//var a = Math.floor(255*comEst/60);
var str1 = "rgb(255,";
var str2 = a.toString();
str1 = str1.concat(str2);
str2 = ",255)";
str1 = str1.concat(str2);
  return str1;
}

function getCommuteColor2(comEst){
var a = Math.floor(255 - 255*comEst/250);
var str1 = "rgb(";
var str2 = a.toString();
str1 = str1.concat(str2);
str1 = str1.concat(",");
str1 = str1.concat(str2);
str2 = ",255)";
str1 = str1.concat(str2);
  return str1;
}

function commuteStyle(feature){
  return{
    fillColor : getCommuteColor2(feature.properties.fac_FELLOW_NUM),
    //fillColor : getCommuteColor(feature.properties.Commute),
    weight : 2,
    opacity : 1,
    color: 'white',
    dashArray : 3,
    fillOpacity : 0.7
  }
}

function metroStyle(feature){
  return{
    weight : 2,
    opacity : 1,
    color: feature.properties.NAME
  }
}

var map = L.map('map').setView([38.99,-77], 10);
//var map = L.map('map').setView([38.99,-77], 6);

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
  maxZoom: 18,
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
  id: 'mapbox.streets'
}).addTo(map);

var NIHmarker = L.marker([39.0033, - 77.0977]).addTo(map);
NIHmarker.bindPopup("<b>NIH Main Campus</b>").openPopup();

FD = L.geoJSON(
  Fellowsdata,
{
  style:commuteStyle,
  onEachFeature : onEachFeature_RR
}).addTo(map);

var mD = L.geoJSON(
  metroData,
{
  style:metroStyle
}).addTo(map);

// control that shows state info on hover
var info = L.control();

info.onAdd = function (map) {
  this._div = L.DomUtil.create('div', 'info');
  this.update();
  return this._div;
};

info.update = function (props) {
//console.log(props.AREA);
  this._div.innerHTML = '<h4>INFO</h4>' +
  (props ?
    '<b>' + 'Area: ' + props.AREA + '</b><br />'
  + 'Num of fellows: ' + props.fac_FELLOW_NUM + '<br />'
//  + 'Commute Time: ' + props.Commute + '<br />'
  + 'ZIP CODE: ' + props.ZCTA5CE10
    : 'Hover over an area');
};

info.addTo(map);

</script>
</body>
</html>
